SELECT CASE WHEN  DATEDIFF(MONTH,FH_NACIMIENTO,GETDATE())/12.0 <18 THEN '<18'			WHEN  DATEDIFF(MONTH,FH_NACIMIENTO,GETDATE())/12.0 <=25 THEN '18-25'			WHEN  DATEDIFF(MONTH,FH_NACIMIENTO,GETDATE())/12.0 <=35 THEN '26-35'			WHEN  DATEDIFF(MONTH,FH_NACIMIENTO,GETDATE())/12.0 <=40 THEN '36-40'			WHEN  DATEDIFF(MONTH,FH_NACIMIENTO,GETDATE())/12.0 <=50 THEN '41-50'			WHEN  DATEDIFF(MONTH,FH_NACIMIENTO,GETDATE())/12.0 <=65 THEN '51-65'			ELSE '+65 años'			 END RANGO_EDAD,			 SUM(SALDO_AHORRO) SALDO_TOTAL_AHORRO,			 AVG(SALDO_AHORRO) SALDO_AVG_AHORRO  FROM TB_CLIENTE_PERFILINNER JOIN TB_CLIENTE_PRODUCTOS    ON TB_CLIENTE_PERFIL.CODIGO=TB_CLIENTE_PRODUCTOS.CODIGO   GROUP BY (CASE WHEN  DATEDIFF(MONTH,FH_NACIMIENTO,GETDATE())/12.0 <18 THEN '<18'			WHEN  DATEDIFF(MONTH,FH_NACIMIENTO,GETDATE())/12.0 <=25 THEN '18-25'			WHEN  DATEDIFF(MONTH,FH_NACIMIENTO,GETDATE())/12.0 <=35 THEN '26-35'			WHEN  DATEDIFF(MONTH,FH_NACIMIENTO,GETDATE())/12.0 <=40 THEN '36-40'			WHEN  DATEDIFF(MONTH,FH_NACIMIENTO,GETDATE())/12.0 <=50 THEN '41-50'			WHEN  DATEDIFF(MONTH,FH_NACIMIENTO,GETDATE())/12.0 <=65 THEN '51-65'			ELSE '+65 años'			 END)   ORDER BY 1SELECT TB_P.CODIGO,			   TB_SEGMENTO.TIPO_SEGMENTO,			   DATEDIFF(MONTH,TB_P.FH_NACIMIENTO,GETDATE())/12.0,			   TB_P.INGRESO,			   TB_PRODUCTOS_MARCA.MARCA_PASIVO AS MARCA_PASIVO,			   TB_PRODUCTOS_MARCA.MARCA_ACTIVO AS MARCA_ACTIVO		  FROM TB_CLIENTE_PERFIL TB_P     LEFT JOIN TB_SEGMENTO	        ON TB_P.COD_SEGMENTO = TB_SEGMENTO.COD_SEGMENTO	 LEFT JOIN (				SELECT CODIGO,	                   IIF((SALDO_AHORRO+SALDO_CTS+SALDO_PLAZO)>0,'SI','NO') MARCA_PASIVO,					   IIF((SALDO_HIPOTECARIO+SALDO_PRESTAMO+SALDO_TARJETA)>0,'SI','NO')  MARCA_ACTIVO					   FROM TB_CLIENTE_PRODUCTOS			    ) TB_PRODUCTOS_MARCA             ON TB_P.CODIGO=TB_PRODUCTOS_MARCA.CODIGOSELECT (CASE WHEN INGRESO <  2500 THEN '0-2.5M'	         WHEN INGRESO <= 3500 THEN '2.5M-3.5M'			 WHEN INGRESO <= 7000 THEN '3.5M-7M'			 ELSE '7M +'			  END) RANGO_INGRESO,		COUNT(*) AS CLIENTES,		SUM(SALDO_TARJETA) AS SALDO_TARJETA,		AVG(SALDO_TARJETA) AS PROMEDIO_TARJETA  FROM TB_CLIENTE_PERFIL  INNER JOIN TB_CLIENTE_PRODUCTOS    ON TB_CLIENTE_PERFIL.CODIGO=TB_CLIENTE_PRODUCTOS.CODIGOGROUP BY (CASE WHEN INGRESO <  2500 THEN '0-2.5M'	         WHEN INGRESO <= 3500 THEN '2.5M-3.5M'			 WHEN INGRESO <= 7000 THEN '3.5M-7M'			 ELSE '7M +'			  END)SELECT TB_PERFIL.*,TB_UBIGEO.*		  FROM TB_CLIENTE_PERFIL    TB_PERFIL	INNER JOIN TB_CLIENTE_PRESTAMOS TB_PRESTAMO	        ON TB_PERFIL.CODIGO = TB_PRESTAMO.CODIGO    INNER JOIN TB_UBIGEO	        ON TB_PERFIL.COD_UBIGEO= TB_UBIGEO.COD_UBIGEO         WHERE TB_PRESTAMO.DESEMBOLSO>15000 		   AND LEFT(TB_PRESTAMO.COD_PRODUCTO,1)='V'		   AND TB_UBIGEO.AREA = 'LIMA Y CALLAO'SELECT PERFIL.CODIGO,	       SALDO_AHORRO,		   PERFIL.INGRESO	  FROM TB_CLIENTE_PERFIL 	PERFIL INNER JOIN TB_CLIENTE_PRODUCTOS PROD        ON PERFIL.CODIGO = PROD.CODIGOINNER JOIN TB_CLIENTE_PRESTAMOS PRES        ON PROD.CODIGO = PRES.CODIGO     WHERE PROD.SALDO_AHORRO > 0	   AND LEFT(PRES.COD_PRODUCTO,1)='V'	   	   ORDER BY 1 --1295